M√©moire requise pour Llama 3.1 70B
Calcul selon la pr√©cision :
Pr√©cisionTaille du mod√®leRAM requiseCommentaireFP16 (16-bit)~140 GB160+ GBPr√©cision maximale, impossible sur votre configQ8 (8-bit)~70 GB90+ GBHaute qualit√©, juste au-dessus de vos 96 GBQ6_K~54 GB70+ GB‚úÖ Faisable sur votre configQ5_K_M~48 GB65+ GB‚úÖ Recommand√© - Bon √©quilibreQ4_K_M~40 GB55+ GB‚úÖ Optimal - Tr√®s bonne qualit√©Q4_0~38 GB50+ GB‚úÖ AcceptableQ3_K_M~30 GB45+ GBQualit√© d√©grad√©e


Pr√©cision      - Taille du mod√®le - RAM requise - Commentaire
FP16 (16-bit)  - ~140 GB          - 160+ GB     - Pr√©cision maximale, impossible sur votre config
Q8 (8-bit)     - ~70 GB           - 90+ GB      - Haute qualit√©, juste au-dessus de vos 96 GB
Q6_K           - ~54 GB           - 70+ GB      - ‚úÖ Faisable sur votre config
Q5_K_M         - ~48 GB           - 65+ GB      - ‚úÖ Recommand√© - Bon √©quilibre
Q4_K_M         - ~40 GB           - 55+ GB      - ‚úÖ Optimal - Tr√®s bonne qualit√©
Q4_0           - ~38 GB           - 50+ GB      - ‚úÖ Acceptable
Q3_K_M         - ~30 GB           - 45+ GB      - Qualit√© d√©grad√©e

Recommandation pour votre setup (96 GB RAM)
Allouez 80-85 GB √† la VM pour faire tourner Llama 3.1 70B en Q4_K_M :

# Sur jarvis-kde, modifier la RAM de la VM
sudo virsh shutdown vm-ia

# √âditer la config
sudo virsh edit vm-ia

Modifier la RAM :
xml
<memory unit='KiB'>87031808</memory>  <!-- 85 GB -->
<currentMemory unit='KiB'>87031808</currentMemory>
xml

# Red√©marrer
sudo virsh start vm-ia

üì• Installation dans la VM

# Se connecter √† la VM
ssh laurent@192.168.1.198

# T√©l√©charger Llama 3.1 70B quantifi√© en Q4_K_M (~40 GB)
ollama pull llama3.1:70b-instruct-q4_K_M

# Ou version Q5 (meilleure qualit√©, ~48 GB)
ollama pull llama3.1:70b-instruct-q5_K_M

# Lister les mod√®les
ollama list

‚öôÔ∏è Configuration Ollama optimale

# Configurer Ollama pour utiliser plus de RAM
sudo mkdir -p /etc/systemd/system/ollama.service.d
sudo nano /etc/systemd/system/ollama.service.d/override.conf

# Configurer Ollama pour utiliser plus de RAM
sudo mkdir -p /etc/systemd/system/ollama.service.d
sudo nano /etc/systemd/system/ollama.service.d/override.conf

Contenu :

[Service]
Environment="OLLAMA_HOST=0.0.0.0:11434"
Environment="OLLAMA_MAX_LOADED_MODELS=1"
Environment="OLLAMA_NUM_PARALLEL=1"
Environment="OLLAMA_KEEP_ALIVE=30m"
# Limiter √† 75 GB de RAM
Environment="OLLAMA_MAX_VRAM=80530636800"

# Appliquer
sudo systemctl daemon-reload
sudo systemctl restart ollama

 Test de performance

# Test simple
time ollama run llama3.1:70b-instruct-q4_K_M "Explique-moi la th√©orie de la relativit√© en 3 phrases"

# Monitoring pendant l'utilisation
watch -n 1 'free -h; echo "---"; ps aux | grep ollama | head -5'

üìä Performance attendue sur votre config
Avec AMD Ryzen 16 c≈ìurs/32 threads + 85 GB RAM :

M√©trique                 - Q4_K_M   - Q5_K_M
Chargement initial       - 15-30s   - 20-40s
Tokens/seconde           - 8-15 t/s - 6-12 t/s
Latence premi√®re r√©ponse - 2-4s     - 3-5s
RAM utilis√©e             - 45-55 GB - 55-65 GB

‚ö° Optimisations possibles
1. Augmenter les threads CPU pour Ollama

sudo nano /etc/systemd/system/ollama.service.d/override.conf

Ajouter :

ini
Environment="OLLAMA_NUM_THREADS=28"  # Utiliser 28 threads sur 32
ini

2. Utiliser mmap pour r√©duire l'usage RAM

# Forcer le memory mapping (plus lent mais moins de RAM)
Environment="OLLAMA_MMAP=1"

3. Offload partiel (si vous aviez un GPU)
Si vous ajoutez un GPU NVIDIA plus tard :

Environment="OLLAMA_NUM_GPU=1"
Environment="OLLAMA_GPU_LAYERS=40"  # 40 couches sur GPU, reste sur CPU

**Configuration VM sugg√©r√©e :**
```
VM normale : 32 GB RAM ‚Üí Mod√®les jusqu'√† 14B
VM "heavy" : 85 GB RAM ‚Üí Llama 70B quand n√©cessaire

Script de bascule RAM

#!/bin/bash
# switch-vm-ram.sh - Sur jarvis-kde

MODE="$1"

case "$MODE" in
    normal)
        RAM="32768"  # 32 GB
        echo "Configuration normale (32 GB)"
        ;;
    heavy)
        RAM="87031808"  # 85 GB en KiB
        echo "Configuration heavy (85 GB)"
        ;;
    *)
        echo "Usage: $0 {normal|heavy}"
        exit 1
        ;;
esac

sudo virsh shutdown vm-ia
sleep 10

sudo virsh setmaxmem vm-ia ${RAM}K --config
sudo virsh setmem vm-ia ${RAM}K --config

sudo virsh start vm-ia

echo "‚úì VM red√©marr√©e avec $RAM RAM"

üìã SCRIPT DE CONFIGURATION AUTOMATIQUE
Cr√©er /tmp/fix-vm-ram.sh sur jarvis-kde :






























